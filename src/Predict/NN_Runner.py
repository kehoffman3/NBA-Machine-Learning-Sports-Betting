import copy
import numpy as np
import pandas as pd
import tensorflow as tf
from colorama import Fore, Style
from tensorflow.keras.models import load_model

model = load_model('Models/NN_Models/Trained-Model-ML')
ou_model = load_model("Models/NN_Models/Trained-Model-OU")


def nn_runner(data, frame_ml, games):
    ml_predictions_array = []

    for row in data:
        ml_predictions_array.append(model.predict(np.array([row])))

    frame_uo = copy.deepcopy(frame_ml)
    #frame_uo['OU'] = np.asarray(todays_games_uo)
    data = frame_uo.values
    data = data.astype(float)
    data = tf.keras.utils.normalize(data, axis=1)

    ou_predictions_array = []

    # for row in data:
    #     ou_predictions_array.append(ou_model.predict(np.array([row])))

    count = 0
    print(games)
    for game in games:
        home_team = game[0]
        away_team = game[1]
        winner = int(np.argmax(ml_predictions_array[count]))
        #under_over = int(np.argmax(ou_predictions_array[count]))
        winner_confidence = ml_predictions_array[count]
        #un_confidence = ou_predictions_array[count]
        if winner == 1:
            winner_confidence = round(winner_confidence[0][1] * 100, 1)
            # if under_over == 0:
            #     un_confidence = round(ou_predictions_array[count][0][0] * 100, 1)
            print(Fore.GREEN + home_team + Style.RESET_ALL + Fore.CYAN + f" ({winner_confidence}%)" + Style.RESET_ALL + ' vs ' + Fore.RED + away_team + Style.RESET_ALL + ': ' +
                      Fore.MAGENTA + game[2])
            # else:
            #     un_confidence = round(ou_predictions_array[count][0][1] * 100, 1)
            #     print(Fore.GREEN + home_team + Style.RESET_ALL + Fore.CYAN + f" ({winner_confidence}%)" + Style.RESET_ALL + ' vs ' + Fore.RED + away_team + Style.RESET_ALL + ': ' +
            #           Fore.BLUE)
        else:
            winner_confidence = round(winner_confidence[0][0] * 100, 1)
            # if under_over == 0:
            #     un_confidence = round(ou_predictions_array[count][0][0] * 100, 1)
            print(Fore.RED + home_team + Style.RESET_ALL + ' vs ' + Fore.GREEN + away_team + Style.RESET_ALL + Fore.CYAN + f" ({winner_confidence}%)" + Style.RESET_ALL + ': ' +
                      Fore.MAGENTA + game[2])
            # else:
            #     un_confidence = round(ou_predictions_array[count][0][1] * 100, 1)
            #     print(Fore.RED + home_team + Style.RESET_ALL + ' vs ' + Fore.GREEN + away_team + Style.RESET_ALL + Fore.CYAN + f" ({winner_confidence}%)" + Style.RESET_ALL + ': ' +
            #           Fore.BLUE)
        count += 1
